c
c 12.01.2009	ggu	new file for system routines
c
c******************************************************************

	subroutine system_init

	implicit none

        integer nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        common /nkonst/ nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        real amat(1)
        common /amat/amat
        real v1v(1)
        common /v1v/v1v

	call lp_init_system(nkn,mbw,amat,v1v)
	!call dlp_init_system(nkn,mbw,amat,v1v)
	!call coo_init_system

	end

c******************************************************************

	subroutine system_solve_z

	implicit none

        integer nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        common /nkonst/ nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        real amat(1)
        common /amat/amat
        real v1v(1),v2v(1),v3v(1)
        common /v1v/v1v, /v2v/v2v, /v3v/v3v

	call lp_solve_system(nkn,mbw,amat,v1v,v2v,v3v)
	!call dlp_solve_system(nkn,mbw,amat,v1v,v2v,v3v)
	!call coo_solve_system

	end

c******************************************************************

	subroutine system_assemble(n,m,kn,mass,rhs)

	implicit none
	integer n,m
	integer kn(3)
	real mass(3,3)
	real rhs(3)

        real amat(1)
        common /amat/amat
        real v1v(1)
        common /v1v/v1v

	integer i,j,kk

	integer loclp
	external loclp
	!integer loccoo
	!external loccoo

        do i=1,3
          do j=1,3
            kk=loclp(kn(i),kn(j),n,m)
            if(kk.gt.0) amat(kk) = amat(kk) + mass(i,j)
            !kk=loccoo(kn(i),kn(j),n,m)
            !if(kk.gt.0) coo(kk) = coo(kk) + mass(i,j)
          end do
          v1v(kn(i)) = v1v(kn(i)) + rhs(i)
        end do

	end

c******************************************************************

        subroutine system_adjust_z

        implicit none

        integer nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        common /nkonst/ nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        real znv(1)
        common /znv/znv
        real v1v(1)
        common /v1v/v1v

        integer k

        do k=1,nkn
          znv(k) = v1v(k)
        end do

        end

c******************************************************************

        subroutine system_add_rhs(dt,array)

        implicit none

	real dt
	real array(1)

        integer nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        common /nkonst/ nkn,nel,nrz,nrq,nrb,nbc,ngr,mbw
        real v1v(1)
        common /v1v/v1v

        integer k

        do k=1,nkn
          v1v(k) = v1v(k) + dt * array(k)
        end do

	end

c******************************************************************

